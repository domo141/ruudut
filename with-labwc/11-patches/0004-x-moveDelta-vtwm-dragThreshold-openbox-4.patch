From d489581308a3be9567951d730009ccadde8b1983 Mon Sep 17 00:00:00 2001
From: Tomi Ollila <tomi.ollila@iki.fi>
Date: Sun, 31 Mar 2024 22:12:08 +0300
Subject: [PATCH] x moveDelta (vtwm), dragThreshold (openbox) -- 4

I used to mention moveDelta in fluxbox, too -- but could not
find that with git grep in repo -- just to find out that I
had personal patch adding that option to fluxbox (hmm, would
they still be interested... :D)
---
 src/input/cursor.c | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/src/input/cursor.c b/src/input/cursor.c
index 2a681a6e..d47305d0 100644
--- a/src/input/cursor.c
+++ b/src/input/cursor.c
@@ -619,6 +619,8 @@ cursor_get_resize_edges(struct wlr_cursor *cursor, struct cursor_context *ctx)
 	return resize_edges;
 }
 
+static double xxx_press_x = -10.0, xxx_press_y = -10.0;
+
 bool
 cursor_process_motion(struct server *server, uint32_t time, double *sx, double *sy)
 {
@@ -645,6 +647,12 @@ cursor_process_motion(struct server *server, uint32_t time, double *sx, double *
 		dnd_icons_move(seat, seat->cursor->x, seat->cursor->y);
 	}
 
+	///wlr_log(WLR_ERROR, "sx: %f  sy: %f ", ctx.sx, ctx.sy);
+	///wlr_log(WLR_ERROR, "cx: %f  cy: %f ", seat->cursor->x, seat->cursor->y);
+	double dx = seat->cursor->x - xxx_press_x;
+	double dy = seat->cursor->y - xxx_press_y;
+	if (dx * dx + dy * dy >= 16) { /* moveDelta / dragThreshold 4 */
+
 	struct mousebind *mousebind;
 	wl_list_for_each(mousebind, &rc.mousebinds, link) {
 		if (ctx.type == LAB_NODE_CLIENT
@@ -662,7 +670,7 @@ cursor_process_motion(struct server *server, uint32_t time, double *sx, double *
 			actions_run(seat->pressed.ctx.view, server,
 				&mousebind->actions, &seat->pressed.ctx);
 		}
-	}
+	}} ///else { printf("%f %f\n", dx, dy); }
 
 	/*
 	 * Cursor context that is actually interacting with cursor and should
@@ -1020,6 +1028,7 @@ process_release_mousebinding(struct server *server,
 			default:
 				continue;
 			}
+			///wlr_log(WLR_ERROR, "RILIIZ");
 			actions_run(ctx->view, server, &mousebind->actions, ctx);
 		}
 	}
@@ -1082,6 +1091,9 @@ process_press_mousebinding(struct server *server, struct cursor_context *ctx,
 				&& modifiers == mousebind->modifiers) {
 			switch (mousebind->mouse_event) {
 			case MOUSE_ACTION_DRAG: /* fallthrough */
+			    xxx_press_x = server->seat.cursor->x;
+			    xxx_press_y = server->seat.cursor->y;
+			    /* fallthrough */
 			case MOUSE_ACTION_CLICK:
 				/*
 				 * DRAG and CLICK actions will be processed on
@@ -1109,6 +1121,7 @@ process_press_mousebinding(struct server *server, struct cursor_context *ctx,
 			}
 			consumed_by_frame_context |= mousebind->context == LAB_NODE_FRAME;
 			consumed_by_frame_context |= mousebind->context == LAB_NODE_ALL;
+			///wlr_log(WLR_ERROR, "PREZZZ");
 			actions_run(ctx->view, server, &mousebind->actions, ctx);
 		}
 	}
-- 
2.52.0

