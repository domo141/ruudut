From bad4efa478b40fa05a33e643a1ec8454f90b4b66 Mon Sep 17 00:00:00 2001
From: Tomi Ollila <tomi.ollila@iki.fi>
Date: Sat, 19 Oct 2024 15:37:13 +0300
Subject: [PATCH 6/7] + add option --title 'title' -- to set text in window
 title bar

---
 src/app.cpp     |  5 ++++-
 src/cmdline.cpp | 12 ++++++++++++
 src/cmdline.h   |  1 +
 3 files changed, 17 insertions(+), 1 deletion(-)

diff --git a/src/app.cpp b/src/app.cpp
index af1c060..70d5a7d 100644
--- a/src/app.cpp
+++ b/src/app.cpp
@@ -445,7 +445,10 @@ XxApp::XxApp( int& argc, char** argv, XxCmdline& cmdline ) :
    adjustLineNumbers();
 
    // Sets the title bar.
-   if ( _nbFiles == 2 ) {
+   if (!_cmdline._titleText.isEmpty()) {
+      _mainWindow->setCaption( _cmdline._titleText );
+   }
+   else if ( _nbFiles == 2 ) {
       QString str =
          QString(_files[0]->getDisplayName()) + " <-> " +
          QString(_files[1]->getDisplayName());
diff --git a/src/cmdline.cpp b/src/cmdline.cpp
index a890303..56a6c3f 100644
--- a/src/cmdline.cpp
+++ b/src/cmdline.cpp
@@ -218,6 +218,9 @@ XxCmdline::Option XxCmdline::_optionsXxdiff[] = {
 // Display options
 //
 XxCmdline::Option XxCmdline::_optionsDisplay[] = {
+   { "title", 0, true, '0', 
+     "Display 'str' in xxdiff window title bar."
+   }, 
    { "title1", 0, true, '1', 
      "Display 'str' instead of filename in filename label 1 (left)."
    }, 
@@ -357,6 +360,7 @@ XxCmdline::XxCmdline() :
    _nbQtOptions( 0 ),
    _qtOptions()
 {
+   _titleText = "";
    _userFilenames[0] = "";
    _userFilenames[1] = "";
    _userFilenames[2] = "";
@@ -518,6 +522,14 @@ bool XxCmdline::parseCommandLine( const int argc, char* const* argv )
             _single = true;
          } break;
 
+         case '0':
+            if ( !optarg ) {
+               throw XxUsageError( XX_EXC_PARAMS,
+                                   "Missing argument for title option." );
+            }
+            _titleText = optarg;
+            break;
+
          case '1':
             if ( !optarg ) {
                throw XxUsageError( XX_EXC_PARAMS,
diff --git a/src/cmdline.h b/src/cmdline.h
index 33b6bd4..f39a73e 100644
--- a/src/cmdline.h
+++ b/src/cmdline.h
@@ -122,6 +122,7 @@ private:
    bool          _forceFont;
 
    bool          _originalXdiff;
+   QString       _titleText;
    QString       _userFilenames[3];
    QString       _stdinFilename;
    bool          _useRcfile;
-- 
2.49.0

